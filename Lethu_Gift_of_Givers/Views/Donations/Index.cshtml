@model IEnumerable<Lethu_Gift_of_Givers.Models.Donation>
@{
    ViewData["Title"] = "My Donations";
}

<div class="container mt-5">
    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold display-6 mb-2">
                <i class="fas fa-donate text-success me-3"></i>My Donations
            </h1>
            <p class="text-muted mb-0">Track your contributions and their impact</p>
        </div>
        <a asp-action="Create" class="btn btn-success btn-lg shadow-sm px-4 py-3">
            <i class="fas fa-plus me-2"></i> New Donation
        </a>
    </div>

    @if (!Model.Any())
    {
        <!-- Empty State -->
        <div class="text-center py-5">
            <div class="profile-icon-lg bg-gradient-secondary mb-4">
                <i class="fas fa-hand-holding-heart fa-3x"></i>
            </div>
            <h3 class="fw-bold mb-3">No Donations Yet</h3>
            <p class="text-muted mb-4">Start making a difference by creating your first donation.</p>
            <a asp-action="Create" class="btn btn-primary btn-lg px-5">
                <i class="fas fa-plus me-2"></i> Make First Donation
            </a>
        </div>
    }
    else
    {
        <!-- Stats Overview -->
        <div class="row mb-5">
            <div class="col-md-3 col-6">
                <div class="card border-0 rounded-3 shadow-sm bg-gradient-primary text-white h-100">
                    <div class="card-body text-center p-4">
                        <i class="fas fa-boxes fa-2x mb-3"></i>
                        <h3 class="fw-bold mb-1">@Model.Count()</h3>
                        <p class="mb-0 small">Total Donations</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="card border-0 rounded-3 shadow-sm bg-gradient-warning text-white h-100">
                    <div class="card-body text-center p-4">
                        <i class="fas fa-clock fa-2x mb-3"></i>
                        <h3 class="fw-bold mb-1">@Model.Count(d => d.Status?.ToLower() == "pending")</h3>
                        <p class="mb-0 small">Pending</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="card border-0 rounded-3 shadow-sm bg-gradient-info text-white h-100">
                    <div class="card-body text-center p-4">
                        <i class="fas fa-check-circle fa-2x mb-3"></i>
                        <h3 class="fw-bold mb-1">@Model.Count(d => d.Status?.ToLower() == "distributed")</h3>
                        <p class="mb-0 small">Distributed</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="card border-0 rounded-3 shadow-sm bg-gradient-success text-white h-100">
                    <div class="card-body text-center p-4">
                        <i class="fas fa-calendar-check fa-2x mb-3"></i>
                        <h3 class="fw-bold mb-1">@Model.Count(d => d.DonationDate > DateTime.UtcNow.AddDays(-30))</h3>
                        <p class="mb-0 small">Last 30 Days</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Donations Table -->
        <div class="card border-0 rounded-3 shadow-lg">
            <div class="card-header bg-gradient-dark text-white py-4 border-0">
                <div class="d-flex align-items-center">
                    <i class="fas fa-list fa-2x me-3"></i>
                    <div>
                        <h4 class="mb-0 fw-bold">DONATION HISTORY</h4>
                        <small class="opacity-90">Your complete donation timeline</small>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th class="ps-4 py-3 fw-bold">
                                    <i class="fas fa-tag me-2"></i>Type
                                </th>
                                <th class="py-3 fw-bold">
                                    <i class="fas fa-align-left me-2"></i>Description
                                </th>
                                <th class="py-3 fw-bold">
                                    <i class="fas fa-balance-scale me-2"></i>Quantity
                                </th>
                                <th class="py-3 fw-bold">
                                    <i class="fas fa-map-marker-alt me-2"></i>Target Area
                                </th>
                                <th class="py-3 fw-bold">
                                    <i class="fas fa-calendar me-2"></i>Date
                                </th>
                                <th class="pe-4 py-3 fw-bold text-center">
                                    <i class="fas fa-tasks me-2"></i>Status
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var donation in Model)
                            {
                                <tr class="border-bottom">
                                    <td class="ps-4 py-3">
                                        <span class="badge @GetDonationTypeBadgeClass(donation.DonationType) px-3 py-2 fs-6">
                                            <i class="@GetDonationTypeIcon(donation.DonationType) me-2"></i>@donation.DonationType
                                        </span>
                                    </td>
                                    <td class="py-3">
                                        <div class="fw-bold text-dark">@donation.ItemDescription</div>
                                        @if (!string.IsNullOrEmpty(donation.SpecialInstructions))
                                        {
                                            <small class="text-muted">@donation.SpecialInstructions</small>
                                        }
                                    </td>
                                    <td class="py-3">
                                        <span class="fw-bold fs-6">@donation.Quantity</span>
                                        <small class="text-muted">@donation.Unit</small>
                                    </td>
                                    <td class="py-3">
                                        <span class="fw-bold">@donation.TargetArea</span>
                                    </td>
                                    <td class="py-3">
                                        <div class="fw-bold">@donation.DonationDate.ToString("MMM dd, yyyy")</div>
                                        <small class="text-muted">@donation.DonationDate.ToString("hh:mm tt")</small>
                                    </td>
                                    <td class="pe-4 py-3 text-center">
                                        <span class="badge @GetStatusBadgeClass(donation.Status) px-3 py-2 fs-6">
                                            @donation.Status
                                        </span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex justify-content-between align-items-center mt-4">
            <div class="text-muted small">
                Showing <strong>@Model.Count()</strong> donations in total
            </div>
            <div class="d-flex gap-2">
                <a asp-action="AllDonations" class="btn btn-outline-primary btn-lg px-4">
                    <i class="fas fa-list me-2"></i> View All Donations
                </a>
                <a asp-action="Create" class="btn btn-success btn-lg px-4">
                    <i class="fas fa-plus me-2"></i> New Donation
                </a>
            </div>
        </div>
    }
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

@functions {
    string GetDonationTypeBadgeClass(string type)
    {
        return type?.ToLower() switch
        {
            "food" => "bg-warning text-dark",
            "clothing" => "bg-info text-white",
            "medical" => "bg-danger text-white",
            "money" => "bg-success text-white",
            _ => "bg-secondary text-white"
        };
    }

    string GetDonationTypeIcon(string type)
    {
        return type?.ToLower() switch
        {
            "food" => "fas fa-utensils",
            "clothing" => "fas fa-tshirt",
            "medical" => "fas fa-first-aid",
            "money" => "fas fa-money-bill-wave",
            _ => "fas fa-gift"
        };
    }

    string GetStatusBadgeClass(string status)
    {
        return status?.ToLower() switch
        {
            "pending" => "bg-warning text-dark",
            "received" => "bg-info text-white",
            "distributed" => "bg-success text-white",
            "cancelled" => "bg-danger text-white",
            _ => "bg-secondary text-white"
        };
    }
}

<style>
    .bg-gradient-primary {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
    }

    .bg-gradient-success {
        background: linear-gradient(135deg, var(--success-color), #2ecc71) !important;
    }

    .bg-gradient-warning {
        background: linear-gradient(135deg, var(--warning-color), #f1c40f) !important;
    }

    .bg-gradient-info {
        background: linear-gradient(135deg, var(--secondary-color), #3498db) !important;
    }

    .bg-gradient-secondary {
        background: linear-gradient(135deg, #6c757d, #495057) !important;
    }

    .bg-gradient-dark {
        background: linear-gradient(135deg, var(--dark-color), #1c2b36) !important;
    }

    .table > :not(caption) > * > * {
        padding: 1rem 0.5rem;
    }

    .table-hover tbody tr:hover {
        background-color: rgba(46, 134, 193, 0.05);
        transform: translateX(4px);
        transition: var(--transition);
    }

    .badge {
        font-weight: 600;
        letter-spacing: 0.5px;
    }

    .btn-success {
        background: linear-gradient(135deg, var(--success-color), #2ecc71);
        border: none;
        font-weight: 600;
    }

        .btn-success:hover {
            background: linear-gradient(135deg, #219653, var(--success-color));
            transform: translateY(-2px);
        }

    .profile-icon-lg {
        width: 120px;
        height: 120px;
        background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
        color: white;
        box-shadow: var(--box-shadow);
    }
</style>